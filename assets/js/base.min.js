angular.module("casa-capp",["ui.router","ngMaterial","firebaseHelper"]).config(["$locationProvider","$urlRouterProvider","$stateProvider","$firebaseHelperProvider",function(e,t,o,r){e.html5Mode(!0),t.when("","/"),o.state("home",{url:"/",templateUrl:"views/page/home.html",controller:"HomeCtrl"}).state("admin",{url:"/admin",templateUrl:"views/page/admin.html",controller:"AdminCtrl"}),r.namespace("casa-capp")}]).factory("Auth",["$rootScope","$firebaseHelper","$state","$q","$timeout",function(e,t,o,r,n){var a=t.auth();return e.$me={},a.$onAuth(function(r){if(r){var n=t.ref("users/"+r.uid);e.$me=t.object(n),t.ref(".info/connected").on("value",function(e){e.val()&&(n.child("online").onDisconnect().set((new Date).toISOString()),n.child("online").set(!0))}),n.update(r),"home"===o.current.name&&o.reload()}else e.$me&&e.$me.$id&&e.$me.$ref().child("online").set((new Date).toISOString()),e.$me={}}),a.$waitForMe=function(){var t=r.defer();return a.$waitForAuth().then(function(){n(function(){t.resolve(e.$me)})}),t.promise},e.isMobile=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),e.isAndroid=/Android/i.test(navigator.userAgent),e.isiOS=/iPhone|iPad|iPod/i.test(navigator.userAgent),e.$auth=a.$auth=function(){return r.when(a.$getAuth()||a["$authWithOAuth"+(e.isMobile?"Redirect":"Popup")]("facebook",{scope:"email"}))},e.$unauth=a.$unauth,a}]).controller("AppCtrl",["$rootScope","$state","$firebaseHelper","Auth",function(e,t,o){e.loaded=!0,e.$state=t,e.$firebaseHelper=o,e.permission=function(){return!!e.$me.$id}}]).controller("HomeCtrl",["$scope","$state","$firebaseHelper","$mdDialog","$mdDialogForm","$q",function(e,t,o,r,n,a){e.$teams=o.array("teams"),e.$games=o.array("games"),e.$scores=o.array("scores"),e.alert=function(e){alert(e)},e.getScores=function(t,o){return t?e.$scores.filter(function(e){return(e.homeTeam===t.$id||e.awayTeam===t.$id)&&(o&&e.game===o.$id||!o)}):[]},e.getPoints=function(t,o,r){if(void 0!==o){if(void 0!==r){var n=(r.homeTeam===t.$id?1:-1)*(r.home-r.away),a=Math.max(0,n),i=a/o.win*10;return i}var l=0;return angular.forEach(e.getScores(t,o),function(r){l+=e.getPoints(t,o,r)}),l}var l=0;return angular.forEach(e.getScores(t),function(o){l+=e.getPoints(t,e.$games.$getRecord(o.game),o)}),l},e.getSpread=function(e,t,o){return o?o.homeTeam===e.$id&&o.home>o.away?o.home+"-"+o.away:o.away+"-"+o.home:void 0},e.getOpponent=function(t,o){return o?e.$teams.$getRecord(o.homeTeam===t.$id?o.awayTeam:o.homeTeam):void 0},e.editScore=function(t){var i=e.$new();i.score=t.$id?o.object(e.$scores,t.$id):angular.copy(t),i.deleteScore=function(t,o){var n=a.defer();return o||confirm("Are you sure you want to permanently delete this score?")?e.$scores.$remove(e.$scores.$getRecord(t.$id)).then(function(){r.hide(),n.resolve()}):(n.reject(),n.promise)},n.show({scope:i,contentUrl:"views/template/score.html",onSubmit:function(t){return t.score.$save?t.score.$save():e.$scores.$add(t.score)}})},e.editTeam=function(t){var i=e.$new();i.team=t.$id?o.object(e.$teams,t.$id):angular.copy(t),i.deleteTeam=function(t,o){var n=a.defer();return o||confirm("Are you sure you want to permanently delete this team?")?e.$teams.$remove(e.$teams.$getRecord(t.$id)).then(function(){r.hide(),n.resolve()}):(n.reject(),n.promise)},n.show({scope:i,contentUrl:"views/template/team.html",onSubmit:function(){return i.team.$save?i.team.$save():e.$teams.$add(i.team)}})}}]).controller("AdminCtrl",["$scope","$state","$firebaseHelper",function(e,t,o){e.$teams=o.array("teams"),e.$games=o.array("games"),e.$scores=o.array("scores")}]).factory("$mdDialogForm",["$mdDialog","$q",function(e,t){return{show:function(o){return e.show(e.confirm(angular.extend({ok:"Submit",cancel:"Cancel",template:['<md-dialog ng-form="dialogForm" md-theme="{{ dialog.theme }}" aria-label="{{ dialog.ariaLabel }}">','<md-dialog-content role="document" tabIndex="-1">','<h2 class="md-title">{{ dialog.title }}</h2>','<p ng-if="dialog.content">{{ dialog.content }}</p>','<div ng-if="dialog.contentUrl" ng-include="dialog.contentUrl"></div>',"</md-dialog-content>",'<div class="md-actions">','<md-button ng-if="dialog.$type == \'confirm\'" ng-click="dialog.abort()">',"{{ dialog.cancel }}","</md-button>",'<md-button ng-disabled="dialogForm.$invalid || dialog.loading" ng-click="dialog.startLoading(); dialog.onSubmit(this).then(dialog.hide).finally(dialog.stopLoading)" class="md-primary">',"{{ dialog.ok }}","</md-button>","</div>","</md-dialog>"].join(""),onSubmit:function(){var e=t.defer();return e.resolve(),e.promise}},o||{})))}}}]).filter("length",function(){return function(e){return angular.isArray(e)?e.length:angular.isObject(e)?Object.keys(e).length:0}}).directive("loading",function(){return{restrict:"E",replace:!0,template:['<div flex layout="column" layout-align="center center">','<md-progress-circular md-mode="indeterminate"></md-progress-circular>',"</div>"].join("")}});