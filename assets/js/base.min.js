angular.module("casa-capp",["ui.router","ngMaterial","firebaseHelper"]).config(["$locationProvider","$urlRouterProvider","$stateProvider","$firebaseHelperProvider",function(e,r,t,a){e.html5Mode(!0),r.when("","/"),t.state("home",{url:"/",templateUrl:"views/page/home.html",controller:"HomeCtrl"}).state("admin",{url:"/admin",templateUrl:"views/page/admin.html",controller:"AdminCtrl"}),a.namespace("casa-capp")}]).factory("Auth",["$rootScope","$firebaseHelper","$state","$q","$timeout",function(e,r,t,a,o){var n=r.auth();return e.$me={},n.$onAuth(function(a){if(a){var o=r.ref("data/users/"+a.uid);e.$me=r.object(o),r.ref(".info/connected").on("value",function(e){e.val()&&(o.child("online").onDisconnect().set(moment().format()),o.child("online").set(!0))}),o.update(a),"home"===t.current.name&&t.reload()}else e.$me={}}),n.$waitForMe=function(){var r=a.defer();return n.$waitForAuth().then(function(){o(function(){r.resolve(e.$me)})}),r.promise},e.$auth=n.$auth=function(){return a.when(n.$getAuth()||n["$authWithOAuth"+(e.isMobile?"Redirect":"Popup")]("facebook",{scope:"email"}))},e.$unauth=n.$unauth,n}]).controller("AppCtrl",["$rootScope","$state","$firebaseHelper","Auth",function(e,r,t){e.loaded=!0,e.$state=r,e.$firebaseHelper=t}]).controller("HomeCtrl",["$scope","$state","$firebaseHelper",function(e,r,t){e.$teams=t.array("teams"),e.$games=t.array("games"),e.$scores=t.array("scores"),e.getScores=function(r,t){return r?e.$scores.filter(function(e){return(e.homeTeam===r.$id||e.awayTeam===r.$id)&&(t&&e.game===t.$id||!t)}):[]},e.getPoints=function(r,t,a){if(void 0!==t){if(void 0!==a){var o=(a.homeTeam===r.$id?1:-1)*(a.home-a.away),n=Math.max(0,o),i=n/t.win*10;return i}var c=0;return angular.forEach(e.getScores(r,t),function(a){c+=e.getPoints(r,t,a)}),c}var c=0;return angular.forEach(e.getScores(r),function(t){c+=e.getPoints(r,e.$games.$getRecord(t.game),t)}),c},e.getSpread=function(e,r,t){return t?t.homeTeam===e.$id&&t.home>t.away?t.home+"-"+t.away:t.away+"-"+t.home:void 0},e.getOpponent=function(r,t){return t?e.$teams.$getRecord(t.homeTeam===r.$id?t.awayTeam:t.homeTeam):void 0}}]).controller("AdminCtrl",["$scope","$state","$firebaseHelper",function(e,r,t){e.$teams=t.array("teams"),e.$games=t.array("games"),e.$scores=t.array("scores")}]).filter("length",function(){return function(e){return angular.isArray(e)?e.length:angular.isObject(e)?Object.keys(e).length:0}}).directive("loading",function(){return{restrict:"E",replace:!0,template:['<div flex layout="column" layout-align="center center">','<md-progress-circular md-mode="indeterminate"></md-progress-circular>',"</div>"].join("")}});